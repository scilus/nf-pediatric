Changes in component 'nf-neuro/registration/ants'
'modules/nf-neuro/registration/ants/environment.yml' is unchanged
'modules/nf-neuro/registration/ants/meta.yml' is unchanged
Changes in 'registration/ants/main.nf':
--- modules/nf-neuro/registration/ants/main.nf
+++ modules/nf-neuro/registration/ants/main.nf
@@ -3,15 +3,13 @@
     tag "$meta.id"
     label 'process_medium'
 
-    container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        "https://scil.usherbrooke.ca/containers/scilus_latest.sif":
-        "scilus/scilus:latest"}"
+    container 'scilus/scilus:2.1.0'
 
     input:
     tuple val(meta), path(fixedimage), path(movingimage), path(mask) //** optional, input = [] **//
 
     output:
-    tuple val(meta), path("*_warped.nii.gz")                        , emit: image
+    tuple val(meta), path("*warped.nii.gz")                        , emit: image
     tuple val(meta), path("*__output0Warp.nii.gz")                  , emit: warp, optional:true
     tuple val(meta), path("*__output1GenericAffine.mat")            , emit: affine
     tuple val(meta), path("*__output1InverseWarp.nii.gz")           , emit: inverse_warp, optional: true
@@ -25,6 +23,7 @@
     script:
     def args = task.ext.args ?: ''
     def prefix = task.ext.prefix ?: "${meta.id}"
+    def suffix = movingimage.name.contains("T1w") ? "T1w" : "T2w"
     def suffix_qc = task.ext.suffix_qc ? "${task.ext.suffix_qc}" : ""
     def ants = task.ext.quick ? "antsRegistrationSyNQuick.sh " :  "antsRegistrationSyN.sh "
     def dimension = task.ext.dimension ? "-d " + task.ext.dimension : "-d 3"
@@ -50,7 +49,7 @@
 
     $ants $dimension -f $fixedimage -m $movingimage -o output -t $transform $args $seed
 
-    mv outputWarped.nii.gz ${prefix}__warped.nii.gz
+    mv outputWarped.nii.gz ${prefix}__${suffix}warped.nii.gz
     mv output0GenericAffine.mat ${prefix}__output1GenericAffine.mat
 
     if [ $transform != "t" ] && [ $transform != "r" ] && [ $transform != "a" ];
@@ -81,11 +80,12 @@
         # Iterate over images.
         for image in fixedimage warped;
         do
-            scil_viz_volume_screenshot.py *\${image}.nii.gz \${image}_coronal.png \
+            mrconvert *\${image}.nii.gz *\${image}_viz.nii.gz -stride -1,2,3 -nthreads $task.cpus
+            scil_viz_volume_screenshot.py *\${image}_viz.nii.gz \${image}_coronal.png \
                 --slices \$coronal_dim --axis coronal \$viz_params
-            scil_viz_volume_screenshot.py *\${image}.nii.gz \${image}_sagittal.png \
+            scil_viz_volume_screenshot.py *\${image}_viz.nii.gz \${image}_sagittal.png \
                 --slices \$sagittal_dim --axis sagittal \$viz_params
-            scil_viz_volume_screenshot.py *\${image}.nii.gz \${image}_axial.png \
+            scil_viz_volume_screenshot.py *\${image}_viz.nii.gz \${image}_axial.png \
                 --slices \$axial_dim --axis axial \$viz_params
             if [ \$image != fixedimage ];
             then
@@ -119,9 +119,10 @@
     stub:
     def args = task.ext.args ?: ''
     def prefix = task.ext.prefix ?: "${meta.id}"
+    def suffix = movingimage.name.contains("T1w") ? "T1w" : "T2w"
 
     """
-    touch ${prefix}__t1_warped.nii.gz
+    touch ${prefix}__${suffix}warped.nii.gz
     touch ${prefix}__output1GenericAffine.mat
     touch ${prefix}__output0InverseAffine.mat
     touch ${prefix}__output1InverseWarp.nii.gz

'modules/nf-neuro/registration/ants/tests/main.nf.test.snap' is unchanged
'modules/nf-neuro/registration/ants/tests/nextflow_quick.config' is unchanged
'modules/nf-neuro/registration/ants/tests/tags.yml' is unchanged
'modules/nf-neuro/registration/ants/tests/nextflow.config' is unchanged
'modules/nf-neuro/registration/ants/tests/nextflow_options.config' is unchanged
'modules/nf-neuro/registration/ants/tests/main.nf.test' is unchanged
************************************************************
