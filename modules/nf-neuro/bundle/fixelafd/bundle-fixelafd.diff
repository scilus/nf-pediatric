Changes in component 'nf-neuro/bundle/fixelafd'
'modules/nf-neuro/bundle/fixelafd/environment.yml' is unchanged
'modules/nf-neuro/bundle/fixelafd/meta.yml' is unchanged
Changes in 'bundle/fixelafd/main.nf':
--- modules/nf-neuro/bundle/fixelafd/main.nf
+++ modules/nf-neuro/bundle/fixelafd/main.nf
@@ -2,16 +2,14 @@
     tag "$meta.id"
     label 'process_single'
 
-    container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        'https://scil.usherbrooke.ca/containers/scilus_2.0.2.sif':
-        'scilus/scilus:2.0.2' }"
+    container 'scilus/scilus:2.0.2'
 
     input:
         tuple val(meta), path(bundles), path(fodf)
 
     output:
-        tuple val(meta), path("*_afd_metric.nii.gz"), emit: fixel_afd
-        path "versions.yml"                         , emit: versions
+        tuple val(meta), path("*_afd_fixel_metric.nii.gz")  , emit: fixel_afd
+        path "versions.yml"                                 , emit: versions
 
     when:
     task.ext.when == null || task.ext.when
@@ -20,10 +18,13 @@
     def prefix = task.ext.prefix ?: "${meta.id}"
 
     """
-    for bundle in $bundles;
-        do\
-        bname=\$(basename \${bundle} .trk)
-        scil_compute_mean_fixel_afd_from_bundles.py \$bundle $fodf ${prefix}__\${bname}_afd_metric.nii.gz
+    for bundle in ${bundles};
+        do \
+        ext=\${bundle#*.}
+        pos=\$((\$(echo \$bundle | grep -b -o __ | cut -d: -f1)+2))
+        bname=\${bundle:\$pos}
+        bname=\$(basename \$bname \${ext})
+        scil_compute_mean_fixel_afd_from_bundles.py \$bundle $fodf ${prefix}__\${bname}_afd_fixel_metric.nii.gz
     done
 
     cat <<-END_VERSIONS > versions.yml
@@ -36,10 +37,16 @@
     def prefix = task.ext.prefix ?: "${meta.id}"
 
     """
+    for bundle in ${bundles};
+        do
+        ext=\${bundle#*.}
+        pos=\$((\$(echo \$bundle | grep -b -o __ | cut -d: -f1)+2))
+        bname=\${bundle:\$pos}
+        bname=\$(basename \$bname \${ext})
+        touch ${prefix}__\${bname}_afd_fixel_metric.nii.gz
+    done
+
     scil_compute_mean_fixel_afd_from_bundles.py -h
-
-    touch ${prefix}_test_afd_metric.nii.gz
-
 
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":

'modules/nf-neuro/bundle/fixelafd/tests/main.nf.test.snap' is unchanged
'modules/nf-neuro/bundle/fixelafd/tests/tags.yml' is unchanged
'modules/nf-neuro/bundle/fixelafd/tests/nextflow.config' is unchanged
'modules/nf-neuro/bundle/fixelafd/tests/main.nf.test' is unchanged
************************************************************
