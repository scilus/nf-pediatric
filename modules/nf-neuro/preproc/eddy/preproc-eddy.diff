Changes in component 'nf-neuro/preproc/eddy'
'modules/nf-neuro/preproc/eddy/environment.yml' is unchanged
'modules/nf-neuro/preproc/eddy/meta.yml' is unchanged
Changes in 'preproc/eddy/main.nf':
--- modules/nf-neuro/preproc/eddy/main.nf
+++ modules/nf-neuro/preproc/eddy/main.nf
@@ -2,9 +2,7 @@
     tag "$meta.id"
     label 'process_high'
 
-    container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        "https://scil.usherbrooke.ca/containers/scilus_latest.sif":
-        "scilus/scilus:latest"}"
+    container 'scilus/scilus:2.1.0'
 
     input:
         tuple val(meta), path(dwi), path(bval), path(bvec), path(rev_dwi), path(rev_bval), path(rev_bvec), path(corrected_b0s), path(topup_fieldcoef), path(topup_movpart)
@@ -14,6 +12,7 @@
         tuple val(meta), path("*__dwi_eddy_corrected.bval") , emit: bval_corrected
         tuple val(meta), path("*__dwi_eddy_corrected.bvec") , emit: bvec_corrected
         tuple val(meta), path("*__b0_bet_mask.nii.gz")      , emit: b0_mask
+        tuple val(meta), path("*__dwi_eddy_restricted_movement_rms.txt"), emit: eddy_fd
         tuple val(meta), path("*__dwi_eddy_mqc.gif")        , emit: dwi_eddy_mqc, optional:true
         tuple val(meta), path("*__rev_dwi_eddy_mqc.gif")    , emit: rev_dwi_eddy_mqc, optional:true
         path "versions.yml"                                 , emit: versions
@@ -106,6 +105,9 @@
         scil_gradients_validate_correct_eddy.py dwi_eddy_corrected.eddy_rotated_bvecs \${bval} \${number_rev_dwi} ${prefix}__dwi_eddy_corrected.bvec ${prefix}__dwi_eddy_corrected.bval
     fi
 
+    # Rename framewise displacement file to include subject id
+    mv dwi_eddy_corrected.eddy_restricted_movement_rms ${prefix}__dwi_eddy_restricted_movement_rms.txt
+
     if $run_qc;
     then
         extract_dim=\$(mrinfo ${dwi} -size)
@@ -184,6 +186,7 @@
     touch ${prefix}__dwi_eddy_corrected.bval
     touch ${prefix}__dwi_eddy_corrected.bvec
     touch ${prefix}__b0_bet_mask.nii.gz
+    touch ${prefix}__dwi_eddy_restricted_movement_rms.txt
 
     cat <<-END_VERSIONS > versions.yml
     "${task.process}":

'modules/nf-neuro/preproc/eddy/tests/main.nf.test.snap' is unchanged
'modules/nf-neuro/preproc/eddy/tests/tags.yml' is unchanged
'modules/nf-neuro/preproc/eddy/tests/nextflow.config' is unchanged
'modules/nf-neuro/preproc/eddy/tests/main.nf.test' is unchanged
************************************************************
