Changes in component 'nf-neuro/preproc/topup'
'modules/nf-neuro/preproc/topup/environment.yml' is unchanged
'modules/nf-neuro/preproc/topup/meta.yml' is unchanged
Changes in 'preproc/topup/main.nf':
--- modules/nf-neuro/preproc/topup/main.nf
+++ modules/nf-neuro/preproc/topup/main.nf
@@ -2,9 +2,7 @@
     tag "$meta.id"
     label 'process_medium'
 
-    container "${ workflow.containerEngine == 'singularity' && !task.ext.singularity_pull_docker_container ?
-        "https://scil.usherbrooke.ca/containers/scilus_latest.sif":
-        "scilus/scilus:latest"}"
+    container "scilus/scilus:2.1.0"
 
     input:
         tuple val(meta), path(dwi), path(bval), path(bvec), path(b0), path(rev_dwi), path(rev_bval), path(rev_bvec), path(rev_b0)
@@ -70,15 +68,18 @@
     if $run_qc;
     then
         extract_dim=\$(mrinfo ${prefix}__b0_mean.nii.gz -size)
-        read sagittal_dim axial_dim coronal_dim <<< "\${extract_dim}"
+        read sagittal_dim coronal_dim axial_dim <<< "\${extract_dim}"
+        mrconvert ${prefix}__b0_mean.nii.gz ${prefix}__b0_mean_viz.nii.gz -stride -1,2,3
+        mrconvert ${prefix}__rev_b0_mean.nii.gz ${prefix}__rev_b0_mean_viz.nii.gz -stride -1,2,3
+        mrconvert ${prefix}__corrected_b0s.nii.gz ${prefix}__corrected_b0s_viz.nii.gz -stride -1,2,3
 
         # Get the middle slice
         coronal_dim=\$((\$coronal_dim / 2))
         axial_dim=\$((\$axial_dim / 2))
         sagittal_dim=\$((\$sagittal_dim / 2))
 
-        fslsplit ${prefix}__corrected_b0s.nii.gz ${prefix}__ -t
-        for image in b0_mean rev_b0_mean 0000 0001;
+        fslsplit ${prefix}__corrected_b0s_viz.nii.gz ${prefix}__ -t
+        for image in b0_mean_viz rev_b0_mean_viz 0000 0001;
         do
             viz_params="--display_slice_number --display_lr --size 256 256"
             scil_volume_math.py normalize_max ${prefix}__\${image}.nii.gz ${prefix}__\${image}_norm.nii.gz
@@ -86,7 +87,7 @@
             scil_viz_volume_screenshot.py ${prefix}__\${image}_norm.nii.gz ${prefix}__\${image}_axial.png \${viz_params} --slices \${axial_dim} --axis axial
             scil_viz_volume_screenshot.py ${prefix}__\${image}_norm.nii.gz ${prefix}__\${image}_sagittal.png \${viz_params} --slices \${sagittal_dim} --axis sagittal
 
-            if [ \$image == "b0_mean" ] || [ \$image == "rev_b0_mean" ];
+            if [ \$image == "b0_mean_viz" ] || [ \$image == "rev_b0_mean_viz" ];
             then
                 title="Before"
             else
@@ -101,11 +102,11 @@
         done
 
         convert -delay 10 -loop 0 -morph 10 \
-                ${prefix}__b0_mean.png ${prefix}__0000.png ${prefix}__b0_mean.png \
+                ${prefix}__b0_mean_viz.png ${prefix}__0000.png ${prefix}__b0_mean_viz.png \
                 ${prefix}__b0_topup_mqc.gif
 
         convert  -delay 10 -loop 0 -morph 10 \
-                ${prefix}__rev_b0_mean.png ${prefix}__0001.png ${prefix}__rev_b0_mean.png \
+                ${prefix}__rev_b0_mean_viz.png ${prefix}__0001.png ${prefix}__rev_b0_mean_viz.png \
                 ${prefix}__rev_b0_topup_mqc.gif
     fi
 

'modules/nf-neuro/preproc/topup/tests/main.nf.test.snap' is unchanged
'modules/nf-neuro/preproc/topup/tests/tags.yml' is unchanged
'modules/nf-neuro/preproc/topup/tests/nextflow.config' is unchanged
'modules/nf-neuro/preproc/topup/tests/main.nf.test' is unchanged
************************************************************
