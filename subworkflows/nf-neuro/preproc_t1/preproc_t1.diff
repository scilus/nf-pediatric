Changes in component 'nf-neuro/preproc_t1'
'subworkflows/nf-neuro/preproc_t1/meta.yml' is unchanged
Changes in 'preproc_t1/main.nf':
--- subworkflows/nf-neuro/preproc_t1/main.nf
+++ subworkflows/nf-neuro/preproc_t1/main.nf
@@ -4,8 +4,8 @@
 include { IMAGE_RESAMPLE } from '../../../modules/nf-neuro/image/resample/main'
 include { BETCROP_ANTSBET } from '../../../modules/nf-neuro/betcrop/antsbet/main'
 include { BETCROP_SYNTHBET} from '../../../modules/nf-neuro/betcrop/synthbet/main'
-include { IMAGE_CROPVOLUME as IMAGE_CROPVOLUME_T1 } from '../../../modules/nf-neuro/image/cropvolume/main'
-include { IMAGE_CROPVOLUME as IMAGE_CROPVOLUME_MASK } from '../../../modules/nf-neuro/image/cropvolume/main'
+include { IMAGE_CROPVOLUME as CROPVOLUME } from '../../../modules/nf-neuro/image/cropvolume/main'
+include { IMAGE_CROPVOLUME as CROPVOLUME_MASK } from '../../../modules/nf-neuro/image/cropvolume/main'
 
 params.preproc_t1_run_synthbet = false
 
@@ -20,13 +20,13 @@
         ch_mask_nlmeans     // channel: [ val(meta), mask ]             , optional
         ch_ref_n4           // channel: [ val(meta), ref, ref-mask ]    , optional
         ch_ref_resample     // channel: [ val(meta), ref ]              , optional
-        ch_weights          // channel: [ val(meta), weights ]          , optional
+        ch_weights          // channel: [ weights ]                    , optional
 
     main:
 
         ch_versions = Channel.empty()
 
-        if ( params.preproc_t1_run_denoising ) {
+        if ( params.preproc_run_denoising ) {
 
             // ** Denoising ** //
             // Result : [ meta, image, mask | [] ]
@@ -45,7 +45,7 @@
             image_nlmeans = ch_image
         }
 
-        if ( params.preproc_t1_run_N4 ) {
+        if ( params.preproc_run_N4 ) {
             // ** N4 correction ** //
             // Result : [ meta, image, reference | [], mask | [] ]
             //  Steps :
@@ -67,7 +67,7 @@
             image_N4 = image_nlmeans
         }
 
-        if ( params.preproc_t1_run_resampling ) {
+        if ( params.preproc_run_resampling ) {
             // ** Resampling ** //
             // Result : [ meta, image, reference | [] ]
             //  Steps :
@@ -85,15 +85,21 @@
             image_resample = image_N4
         }
 
-        if ( params.preproc_t1_run_synthbet ) {
-            // ** SYNTHBET ** //
+        if ( params.preproc_run_synthstrip ) {
+            // ** SYNTHSTRIP ** //
             // Result : [ meta, image, weights | [] ]
             //  Steps :
             //   - join [ meta, image, weights | null ]
             //   - map  [ meta, image, weights | [] ]
             ch_bet = image_resample
-                .join(ch_weights, remainder: true)
-                .map{ it[0..1] + [it[2] ?: []] }
+                .combine(ch_weights)
+                .branch {
+                    infant: it[0].age < 2.5 || it[0].age > 18
+                        return [it[0], it[1], it[2]]
+                    child: it[0].age >= 2.5 && it[0].age <= 18
+                        return [it[0], it[1], []]
+                }
+            ch_bet = ch_bet.infant.mix(ch_bet.child)
 
             BETCROP_SYNTHBET ( ch_bet )
             ch_versions = ch_versions.mix(BETCROP_SYNTHBET.out.versions.first())
@@ -102,7 +108,7 @@
             image_bet = BETCROP_SYNTHBET.out.bet_image
             mask_bet = BETCROP_SYNTHBET.out.brain_mask
         }
-        else if ( params.preproc_t1_run_ants_bet ) {
+        else if ( params.preproc_run_ants_bet ) {
             // ** ANTSBET ** //
             // The template and probability maps are mandatory if running antsBET. Since the
             // error message from nextflow when they are absent is either non-informative or
@@ -127,23 +133,23 @@
             mask_bet = Channel.empty()
         }
 
-        if ( params.preproc_t1_run_crop ) {
+        if ( params.preproc_run_crop ) {
             // ** Crop image ** //
             ch_crop = image_bet
                 .map{ it + [[]] }
 
-            IMAGE_CROPVOLUME_T1 ( ch_crop )
-            ch_versions = ch_versions.mix(IMAGE_CROPVOLUME_T1.out.versions.first())
-            image_crop = IMAGE_CROPVOLUME_T1.out.image
-            bbox = IMAGE_CROPVOLUME_T1.out.bounding_box
+            CROPVOLUME ( ch_crop )
+            ch_versions = ch_versions.mix(CROPVOLUME.out.versions.first())
+            image_crop = CROPVOLUME.out.image
+            bbox = CROPVOLUME.out.bounding_box
 
             // ** Crop mask ** //
             ch_crop_mask = mask_bet
-                .join(IMAGE_CROPVOLUME_T1.out.bounding_box)
+                .join(CROPVOLUME.out.bounding_box)
 
-            IMAGE_CROPVOLUME_MASK ( ch_crop_mask )
-            ch_versions = ch_versions.mix(IMAGE_CROPVOLUME_MASK.out.versions.first())
-            mask_crop = IMAGE_CROPVOLUME_MASK.out.image
+            CROPVOLUME_MASK ( ch_crop_mask )
+            ch_versions = ch_versions.mix(CROPVOLUME_MASK.out.versions.first())
+            mask_crop = CROPVOLUME_MASK.out.image
         }
         else {
             image_crop = image_bet

'subworkflows/nf-neuro/preproc_t1/tests/main.nf.test.snap' is unchanged
'subworkflows/nf-neuro/preproc_t1/tests/nextflow_quick.config' is unchanged
'subworkflows/nf-neuro/preproc_t1/tests/nextflow_synthbet.config' is unchanged
'subworkflows/nf-neuro/preproc_t1/tests/tags.yml' is unchanged
'subworkflows/nf-neuro/preproc_t1/tests/nextflow.config' is unchanged
'subworkflows/nf-neuro/preproc_t1/tests/main.nf.test' is unchanged
'subworkflows/nf-neuro/preproc_t1/tests/nextflow_skip_all.config' is unchanged
************************************************************
